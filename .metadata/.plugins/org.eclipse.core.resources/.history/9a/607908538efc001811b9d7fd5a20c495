package io.altar.business;

import java.util.ArrayList;
import java.util.Arrays;
import java.util.Collection;
import java.util.Iterator;
import java.util.List;

import io.altar.models.*;
import io.altar.repository.*;

public class ProductBusiness {
	public static ProductRepository productRepository1 = ProductRepository.getInstance();
	public static ShelfRepository shelfRepository1 = ShelfRepository.getInstance();

	public static Product addNewProductToProductRepository(Product productToAdd) {
		productRepository1.createEntity(productToAdd);
		if (productToAdd.getShelvesList().size() > 0) {
			List <Shelf> newShelvesList=productToAdd.getShelvesList();
			ArrayList<Shelf> oldShelvesList=(ArrayList<Shelf>) newShelvesList.clone();
			for (Shelf item : oldShelvesList) {
				if (shelfRepository1.fetchEntityById(item.getId()).getProductInShelf() == null) {
					shelfRepository1.fetchEntityById(item.getId()).setProductInShelf(productToAdd);
				} else {
					productRepository1.fetchEntityById(productToAdd.getId()).getShelvesList().remove(item);
				}
			}
		}

		return productRepository1.fetchEntityById(productToAdd.getId());
	}

	public static void removeProductFromProductId(long productId) {
		Product oldProduct = productRepository1.fetchEntityById(productId);
		if (oldProduct.getShelvesList().size() > 0) {
			for (Shelf item : oldProduct.getShelvesList()) {
				shelfRepository1.fetchEntityById(item.getId()).setProductIdInShelf(VER O QUE POR AQUI);
			}
		}
		productRepository1.deleteEntityById(productId);
	}

	public static void updateShelfRepositoryAccordingToShelvesList(ArrayList<Shelf> shelvesList, long productId) {
		productRepository1.fetchEntityById(productId).setShelvesList(shelvesList);
	}

	public static boolean isThereThisShelf(long shelfIdToTest) {
		if (shelfRepository1.fetchEntityById(shelfIdToTest) == null) {
			return false;
		} else {
			return true;
		}
	}

	public static Collection<Product> getAllProducts() {
		return productRepository1.showAll();
	}

	public static boolean isThereThisProduct(long productIdToTest) {
		if (productRepository1.fetchEntityById(productIdToTest) == null) {
			return false;
		} else {
			return true;
		}
	}

	public static Product getAProduct(long productIdToSee) {
		return productRepository1.fetchEntityById(productIdToSee);
	}

	public static Product changeProduct(Product productToChange) {
		if(!productRepository1.fetchEntityById(productToChange.getId()).getShelvesList().isEmpty()){
			for (Shelf item : productRepository1.fetchEntityById(productToChange.getId()).getShelvesList()) {
				shelfRepository1.fetchEntityById(item.getId()).setProductInShelf(VER O QUE POR AQUI);
			}
		}
		if(!productToChange.getShelvesList().isEmpty()){
			for (Shelf item : productToChange.getShelvesList()) {
				shelfRepository1.fetchEntityById(item.getId()).setProductInShelf(productToChange);
			}
		}
		productRepository1.changeEntityById(productToChange);
		return productRepository1.fetchEntityById(productToChange.getId());
	}
}
